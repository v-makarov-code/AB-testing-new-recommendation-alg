# А/Б тест нового алгоритма рекоммендаций постов

## Описание эксперемента 

Анализ результатов эксперимента, который проводился вместе с командой дата сайетистов.
Для эксперимента были задействованы 2 и 1 группы. В группе 2 был использован один из новых алгоритмов рекомендации постов, группа 1 использовалась в качестве контроля.
Основная гипотеза заключается в том, что новый алгоритм во 2-й группе приведет к увеличению CTR. 

**Цель**: Проверка гипотезы об увеличении CTR новым алгоритмом.  
**Даты А/Б-теста**: 2025-05-02 — 2025-05-08, группы 1 (контроль) и 2 (тест).
**Даты А/А-теста**: 2025-04-25 — 2025-05-01, группы 1 (контроль) и 2 (тест).

**Описание выполнения анализа**:
1. Убедимся, что система сплитования работает корректно из результатов А/А-теста. Если система работает корректно, то статистически значимые различия между двумя группами встречались бы только в результате случайного ложного срабатывания. Например, если мы отвергаем нулевую гипотезу при условии, что `p_value` < 0.05, то только приблизительно в 5% случаев у нас бы получались статистические значимые различия между 0 и 1 группой. Будем многократно извлекать подвыборки из наших данных, проводить t-test, а в конце посмотрим, в каком проценте случаев нам удалось отклонить нулевую гипотезу. Сделаем следующие:
    -  Возьмем данные АА-теста из данного диапазона: с '2025-04-25' по '2025-05-01'
    -  Из 2 и 3 групп берем подвыборки без возвращения размеров в 500 юзеров
    -  Сравниваем их T-тестом и сохраняем `p-value` (используем аргумент `equal_var=False`))
    -  Повторяем это 10000 раз
Распределение получившихся **p-value** является примерно равномерным.  
Доля **p-value** ниже порога значимости составляет около **0.049**.  
Это примерно столько, сколько мы ожидаем. Значит, система сплитования 
работает корректно.

2. Проведены сравнения контрольной и тестовой групп при помощи таких тестов как:
   - Т-тест
   - Тест Манна-Уитни
   - T-тест на сглаженном ctr ($\alpha$ = 5)
   - Пуасоновский бутстреп
   - T-тест на бакетном преобразовании 
   - Тест Манна-Уитни на бакетном преобразовании
3. Результаты показали, что классический Т-тест и Т-тест на сглаженном ctr не видит различия в средних значениях в группах. Классический тест Манна-Уитни, а также тест Манна-Уитни на бакетном преобразовании строго видит, что распределения различаются. Пуасоновский бутстреп видит, что ctr в тестовой группе строго меньше чем в контрольной. Т-тест на бакетном преобразовании находит различия в средних.
4. Потенциальная причина, почему классический Т-тест и Т-тест на сглаженном ctr не видит различий с средних, это бимодальность распределения тестовой группы. Т-тест сравнивает средние значения и среднее значение может быть нерепрезентативным для описания данных, так как оно может находиться между пиками и не отражать реальную структуру распределения. Напротив, в тесте Манна-Уитни проверяется не средние или медианы, а эквивалентность распределения, что легко распознается этим тестом, что это не так. Пуасоновский бутстрап сравнивает не поюзерный ctr, а глобальный, поэтому он является довольно чувствительным, но медленным. Аналогичная причина для бакетного преобразования, который моделирует бутсреп в миниатюре. Сравнивает не поюзерный ctr, а потенциальный глобальных ctr и сравнивает его распределения в обоих группах.
5. Тестая группа явно раздилилась на два лагеря, одним изменения в алгоритме явно пошло на пользу в поисках постов, которые им понравятся, другим напротив алгоритм резко усугубил ситуацию. Это может быть потенциальная ошибка в алгоритме, где часто рекомендуется таже или перепост такой же публикации. 
6. **В любом случае не рекомендуется** выкатывать новый алгоритм на всех пользователей. Даже если бы все проведенные тесты не заметили бы различий в ctr, или все тесты показывали, что ctr выше в тестовой группе, вывод бы оставался таким же, так как в тестовой группе явно присутвуют большое кол-во недовольных или неудовлетвореных пользователей новым алгоритмом. Но также можно сослаться на то что более чувствительный пуассоновский бутстреп или бакетное преобразование, которые видят что ctr в тестовой группе строго меньше чем в контроле. 
